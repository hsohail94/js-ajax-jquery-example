<!--
    Haaris Sohail
    G00709380
    SWE 642
    Assignment 3
    03/07/2018
-->


<?xml version = "1.0" encoding = "utf-8"?>
<!DOCTYPE html PUBLIC " "- - //W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1- - strict.dtd"> 

 <html xmlns = "http://www.w3.org/1999/xhtml">
    <head>
        <title> GMU CS Survey Page </title>

        <style type = "text/css">

            h1  {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
                font-weight: bolder;
                font-size: 20pt;
                color:blue;
                text-shadow: 2px 2px blue
            }

            h3  {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
                font-weight: bold;
                font-size: 18pt;
                color:crimson;
            }

            label {
                display:block;
                position:relative;
                padding-left:130px;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
                padding-bottom: 10px;
            }
            
            label > span {
                position:absolute;
                left:0;
                
            }

            p   {
                font-size: 12pt;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            }

            option {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            }

            body {
                background-color: gainsboro
            }

            .bottom_right {
                position: fixed; right: 0px; bottom: 0px;
            }


        </style>

    <script type="text/javascript">

        //set username cookie to value cookieValue to expire in expiryDays
        function setUsernameCookie (cookieValue, expiryDays)
        {
            //date object for current time/date
            var date = new Date();

            //expiry time = current time + days*24*60*60*1000
            date.setTime(date.getTime() + (expiryDays*24*60*60*1000)) 

            //line which actually sets the username cookie
            document.cookie = "username=" + cookieValue + ";expires=" + date.toUTCString() + ";path=/";
        }

        //function to get username cookie (if it was set)
        function getUsernameCookie()
        {
           var usernameCookie = "username=";

           //comprehensive cookies list, separated by semi-colon
           //var cookiesList = document.cookie.split(";");
           var decodedCookie = decodeURIComponent(document.cookie);
           var cookiesList = decodedCookie.split(';');

           //iterate through cookies to look for "username="; return null if not found
           for (var i = 0; i < cookiesList.length; i++)
           {
               var cookieElement = cookiesList[i];
               while (cookieElement.charAt(0) == ' ')
               {
                   cookieElement = cookieElement.substring(1);
               }
                if (cookieElement.indexOf(usernameCookie) == 0)
                {
                  return cookieElement.substring(usernameCookie.length, cookieElement.length);
                }
               
           }
           return ""; //return nothing if username cookie not found
        }

        //if username cookie is not set, set it. otherwise, get it and display it
        function checkUsernameCookie()
        {
            var username = getUsernameCookie();

            if (username != "")
            {
                alert ("Welcome " + username + "!");
            }
            else
            {
                username = prompt("What is your name? ", "");
                if (username != "" && username != null)
                {
                    setUsernameCookie(username, 10);
                    //document.getElementById('name').textContent = username;
                }
            }
        }

        //calculate average and max from user input, then display on screen
        function calculateAverageAndMax()
        {
            var userNumbersInput = document.getElementById("usernumbers").value;

            var userNumbers = userNumbersInput.split(',');

            var inputInRange = 1;

            //only calculate the average and max if user has entered at least 10 numbers
            if (userNumbers.length >= 10)
            {
                var total = 0;
                for (i = 0; i < userNumbers.length; i++)
                {
                    var userNumber = userNumbers[i];
                    if (userNumber < 1 || userNumber > 100)
                    {
                        document.getElementById('max').textContent = "Please enter number between 1 and 100";
                        document.getElementById('avg').textContent = "Please enter number between 1 and 100";
                        inputInRange = 0;
                        break;
                    }
                    else
                    {
                        total = total + parseInt(userNumber);
                    }
                }

                if (inputInRange == 1)
                {
                    //set average and max fields
                    var average = total / userNumbers.length;
                    document.getElementById('avg').textContent = average.toString();
                    
                    var maximum = getMaximumNumber(userNumbers);
                    document.getElementById('max').textContent = maximum.toString();
                }
            }
        }

        //given array of numbers, calculate maximum
        function getMaximumNumber (numbersList)
        {
            var originalMax = parseInt(numbersList[0]);
            for (i = 1; i < numbersList.length; i++)
            {
                var current = parseInt(numbersList[i]);
                if (current > originalMax)
                    originalMax = current;
            }

            return originalMax;
        }

        //validating user data
        function handleSubmittedUserData()
        {
            var enteredName = document.getElementById("firstName").value + 
                                document.getElementById("lastName").value;
            console.log("full name: " + enteredName);

            var enteredEmail = document.getElementById("email").value;
            var enteredAddress = document.getElementById("address").value;

            var likedMostChecked = document.getElementsByName("mostliked");
            var howInterestedChecked = document.getElementsByName("foundout");

            //check how many checkboxes are checked
            var checkboxCount = 0;
            for (i = 0; i < likedMostChecked.length; i++)
            {
                if (likedMostChecked[i].checked)
                {
                    checkboxCount++;   
                }
            }

            //check if any of the radio buttons have been checked
            var radioChecked = false;
            for (i = 0; i < howInterestedChecked.length; i++)
            {
                //if one is selected, break, as that is all we need
                if (howInterestedChecked[i].checked)
                {
                    radioChecked = true;
                    break;
                }
            }

            //check if full name is alphabets-only
            var alphabetsOnlyRegex = new RegExp('/^[a-zA-Z]*$/');
            if (!alphabetsOnlyRegex.test(enteredName))
            {
                console.log("name regex test failed");
                document.getElementById("firstName").value = "";
                document.getElementById("lastName").value = "";
                document.getElementById("firstName").insertAdjacentHTML("afterend", "<input type = \"text\"> <b> Please make sure your name only has alphabets </input>");
                document.getElementById("lastName").insertAdjacentHTML("afterend", "<input type = \"text\"> <b> Please make sure your name only has alphabets </input>");
            }

            //check if email address is in valid format
            var emailRegex = new RegExp('/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/');
            if (!enteredEmail.test(emailRegex))
            {
                console.log("email regex test failed");
                document.getElementById("email").value = "";
                document.getElementById("email").insertAdjacentHTML("afterend", "<input type = \"text\"> <b> Please enter a valid email adress. </input>");
            }


        }

    </script>

    </head>

    <body onload="checkUsernameCookie()">
        <h1>GMU Department of Computer Science User Feedback Survey</h1>
        <h3><i> Please fill out the following information below: </i></h3>

        <form name="usersurvey" onsubmit="handleSubmittedUserData()">

            <!--
                 Good morning <span id = "username"></span>
            <script>
                document.getElementById('name').textContent = Cookies.get('username');
            </script> -->

            <label><span> First Name: </span>
                <input id = "firstName" type = "text" size = "35" maxlength="50" required autofocus autocomplete="on"/>
            </label>

            <label><span>Last Name: </span> 
                <input id = "lastName" type = "text" size = "35" maxlength="50" required autocomplete="on"/>
            </label>

            <label>
                <span>User ID: </span>
                <input id = "userid" type = "text" size = "10" maxlength = "30" autocomplete="on">
            </label>

            <label>
                <span>Movie ID: </span>
                <input id = "movieid" type = "text" size = "10" maxlength = "30" autocomplete="on">
            </label>

            <label>
                <span>Movie Rating: </span>
                <input id = "movierating" type = "text" size = "1" maxlength = "1" autocomplete="on">
            </label>

            <label>
                <span>Timestamp: </span>
                <input id = "timestamp" type = "text" size = "7" maxlength="10" autocomplete="on">
            </label>

            <label>
                <span>Email: </span>
                <input id = "email" type = "text" size = "50" maxlength="200" placeholder="yourname@email.com" required autocomplete="on"/>
            </label>

            <label>
                <span>Street Address: </span>
                <input id = "address" type = "text" size = "75" maxlength = "500" autocomplete="on"/>
            </label>

            <label>
                <span>City: </span>
                <input id = "city" type = "text" size = "40" maxlength="200" autocomplete="on"/>
            </label>

            <label>
                <span>State: </span>
                <input id = "stateCode" type = "text" size = "5" maxlength = "5" autocomplete="on"/>
            </label>

            <label>
                <span>Zip: </span>
                <input id = "zipCode" type = "text" size = "5" maxlength = "5" placeholder="01234" autocomplete="on"/>
            </label>

            <label>
                <span>Phone Number: </span>
                <input id = "phoneNumber" type = "text" size="10" maxlength="10" placeholder="5713120192" autocomplete="on"/>
            </label>

            <label>
                <span>Date of Survey: </span>
                <input id = "surveyDate" type = "date" required>
            </label>

            <label>
                <span>Graduation Date: </span>
                <input list = "months" name = "month" placeholder="Month" size="12">
                <datalist id = "months">
                    <option value = "January">
                    <option value = "February">
                    <option value = "March">
                    <option value = "April">
                    <option value = "May">
                    <option value = "June">
                    <option value = "July">
                    <option value = "August">
                    <option value = "September">
                    <option value = "October">
                    <option value = "November">
                    <option value = "December">
                </datalist>
                <input id = "gradYear" type = "text" size = "4" maxlength="4" placeholder="yyyy">
            </label>

            <br>

            <i> Please tell us what you liked most about the university: </i> <br>
                    <input type="checkbox" name="mostliked" value="Sports"> Sports<br>
                    <input type="checkbox" name="mostliked" value="Location"> Location<br>
                    <input type="checkbox" name="mostliked" value="Campus"> Campus <br>
                    <input type="checkbox" name="mostliked" value="DormRoom"> Dorm Rooms <br>
                    <input type="checkbox" name="mostliked" value="atmos"> Atmosphere <br>
        
            <br>

            <i> Please tell us how you became interested in the university: </i> <br>
                    <input type="radio" name="foundout" value="Friends"> Friends <br>
                    <input type="radio" name="foundout" value="Internet"> Internet <br>
                    <input type="radio" name="foundout" value="Television"> Television  <br>
                    <input type="radio" name="foundout" value="Other"> Other <br>

            <br>

            <i> Please tell us the likelihood of you recommeding the university to a friend: </i> <br>
            <select>
                <option value="verylikely">Very Likely</option>
                <option value="likely">Likely</option>
                <option value="notlikely">Not likely at all</option>
            </select>

            <br> <br>

            <i> Please provide any additional comments in the text area below: </i> <br>
            <textarea rows="5" cols="55"></textarea>

            <br> <br>

            Data: <input id = "usernumbers" type = "text" size = "10" oninput="calculateAverageAndMax()"/>  <br> <br>

            Max: <span id="max" name="maxValue"></span> <br> <br>
            Avg: <span id="avg" name="avgValue"></span> <br> <br>

            <input type="submit" value="Submit" name="userSubmit">
            <input type="reset" value="Reset Data" name="userReset">
        </form>

        <div id="gmu_logo" class="bottom_right">
            <img src="https://www2.gmu.edu/sites/all/modules/features/feature_core_theme/templates/resources/images/mason-logo-green.png" style="width:200px;height:200px">
        </div>

    </body>
 </html>